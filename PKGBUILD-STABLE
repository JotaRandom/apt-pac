# Maintainer: Your Name <user@archlinux.org>

pkgname=apt-pac
pkgver=2026.01.01
pkgrel=1
pkgdesc="An APT-style wrapper for pacman with APT-like output"
arch=('any')
url="https://github.com/JotaRandom/apt-pac"
license=('MIT')
depends=('python'
         'python-rich'
         'pyalpm'
         'python-tomli'
         'devtools')
makedepends=('python-build'
             'python-installer'
             'python-setuptools'
             'python-wheel'
             'git'
             'gettext')
optdepends=('man: For apt help command to display package manpages')
source=("$_pkgname::git+https://github.com/JotaRandom/$pkgname.git#tag=$pkgver")
sha256sums=('SKIP')

pkgver() {
  cd "$srcdir/$pkgname"
  git describe --tags --long | sed 's/^v//;s/-/+/g'
}

build() {
  cd "$srcdir/$pkgname"
  python -m build --wheel --no-isolation

  # Compile translations
  echo "Compiling translations..."
  for po_file in locales/*.po; do
    if [ -f "$po_file" ]; then
      msgfmt -o "${po_file%.po}.mo" "$po_file"
    fi
  done
}

package() {
  cd "$srcdir/$pkgname"
  python -m installer --destdir="$pkgdir" dist/*.whl
  
  # Install global configuration
  install -Dm644 config.toml "$pkgdir/etc/apt-pac/config.toml"

  # Install manpage
  install -Dm644 src/man/apt-pac.8 "$pkgdir/usr/share/man/man8/apt-pac.8"

  # Install translations
  for mo_file in locales/*.mo; do
    if [ -f "$mo_file" ]; then
      locale=$(basename "$mo_file" .mo)
      install -Dm644 "$mo_file" "$pkgdir/usr/share/locale/$locale/LC_MESSAGES/apt-pac.mo"
    fi
  done

  # Install shell completions
  install -Dm644 src/completions/apt-pac.bash "$pkgdir/usr/share/bash-completion/completions/apt-pac"
  install -Dm644 src/completions/_apt-pac "$pkgdir/usr/share/zsh/site-functions/_apt-pac"
  install -Dm644 src/completions/apt-pac.fish "$pkgdir/usr/share/fish/vendor_completions.d/apt-pac.fish"
}
